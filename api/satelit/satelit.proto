syntax = "proto3";

package satelit;
option  go_package = ".;satelit";

service Satelit {
  rpc GetVolumes(GetVolumesRequest) returns (GetVolumesResponse) {}
  rpc AddVolume(AddVolumeRequest) returns (AddVolumeResponse) {}
  rpc AttachVolume(AttachVolumeRequest) returns (AttachVolumeResponse) {}
  rpc UploadImage(stream UploadImageRequest) returns (UploadImageResponse) {}
}

// type
message Volume {
  string id            = 1;
  bool   attached      = 2;
  string hostname      = 3;
  uint32 capacity_byte = 4;
}

message Image {
  string id          = 1;
  string name        = 2;
  string volume_id   = 3;
  string description = 4;
}

// Request / Response
message GetVolumesRequest {}

message GetVolumesResponse {
  repeated Volume volumes = 1;
}

message AddVolumeRequest {
  string name          = 1;
  uint32 capacity_byte = 2;
}

message AddVolumeResponse {
  Volume volume = 1;
}

message AttachVolumeRequest {
  string id       = 1;
  string hostname = 2;
}

message AttachVolumeResponse {}

message DeleteVolumeRequest {}

message DeleteVolumeResponse {}

message UploadImageRequest {
  oneof value {
    UploadImageRequestMeta  meta  = 1;
    UploadImageRequestChunk chunk = 2;
  }
}

message UploadImageRequestMeta {
  string name        = 1;
  string description = 2;
}

message UploadImageRequestChunk {
  bytes data     = 1;
  int64 position = 2;
}

message UploadImageResponse {
  Image image = 1;
}