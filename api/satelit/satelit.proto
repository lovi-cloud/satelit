syntax = "proto3";

package satelit;
option  go_package = ".;satelit";

service Satelit {
  rpc GetVolumes(GetVolumesRequest) returns (GetVolumesResponse) {}
  rpc AddVolume(AddVolumeRequest) returns (AddVolumeResponse) {}
  rpc AddVolumeImage(AddVolumeImageRequest) returns (AddVolumeImageResponse) {}
  rpc AttachVolume(AttachVolumeRequest) returns (AttachVolumeResponse) {}
  rpc GetImages(GetImagesRequest) returns (GetImagesResponse) {}
  rpc UploadImage(stream UploadImageRequest) returns (UploadImageResponse) {}
  rpc DeleteImage(DeleteImageRequest) returns (DeleteImageResponse) {}
  rpc AddVirtualMachine(AddVirtualMachineRequest)
      returns (AddVirtualMachineResponse) {}
  rpc StartVirtualMachine(StartVirtualMachineRequest)
      returns (StartVirtualMachineResponse) {}
}

// type
message Volume {
  string id            = 1;
  bool   attached      = 2;
  string hostname      = 3;
  uint32 capacity_byte = 4;
}

message Image {
  string id          = 1;
  string name        = 2;
  string volume_id   = 3;
  string description = 4;
}

// Request / Response
message GetVolumesRequest {}

message GetVolumesResponse {
  repeated Volume volumes = 1;
}

message AddVolumeRequest {
  string name          = 1;
  uint32 capacity_byte = 2;
}

message AddVolumeResponse {
  Volume volume = 1;
}

message AddVolumeImageRequest {
  string name            = 1;
  uint32 capacity_byte   = 2;
  string source_image_id = 3;
}

message AddVolumeImageResponse {
  Volume volume = 1;
}

message AttachVolumeRequest {
  string id       = 1;
  string hostname = 2;
}

message AttachVolumeResponse {}

message DeleteVolumeRequest {}

message DeleteVolumeResponse {}

message GetImagesRequest {}

message GetImagesResponse {
  repeated Image images = 1;
}

message UploadImageRequest {
  oneof value {
    UploadImageRequestMeta  meta  = 1;
    UploadImageRequestChunk chunk = 2;
  }
}

message UploadImageRequestMeta {
  string name        = 1;
  string description = 2;
}

message UploadImageRequestChunk {
  bytes data     = 1;
  int64 position = 2;
}

message UploadImageResponse {
  Image image = 1;
}

message DeleteImageRequest {
  string id = 1;
}

message DeleteImageResponse {}

message AddVirtualMachineRequest {
  string name            = 1;
  uint32 vcpus           = 2;
  uint64 memory_kib      = 3;
  uint32 root_volume_gb  = 4;
  string source_image_id = 5;
  string hypervisor_name = 6;
}

message AddVirtualMachineResponse {
  string uuid = 1;
  string name = 2;
}

message StartVirtualMachineRequest {
  string uuid = 1;
}

message StartVirtualMachineResponse {
  string uuid = 1;
  string name = 2;
}